{"version":3,"file":"extension.js","mappings":"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","sources":["webpack://atomic-tree-engine/external node-commonjs \"child_process\"","webpack://atomic-tree-engine/external commonjs \"vscode\"","webpack://atomic-tree-engine/webpack/bootstrap","webpack://atomic-tree-engine/./src/extension.ts"],"sourcesContent":["module.exports = require(\"child_process\");","module.exports = require(\"vscode\");","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","import * as vscode from 'vscode';\r\nimport { spawn, ChildProcess } from 'child_process';\r\nimport * as path from 'path';\r\n\r\nlet backendProcess: ChildProcess | undefined;\r\n\r\nexport function activate(context: vscode.ExtensionContext) {\r\n    console.log('Atomic Tree Engine is active!');\r\n\r\n    // 1. Register Views\r\n    const provider = new AtomicTreeWebviewProvider(context.extensionUri);\r\n    context.subscriptions.push(\r\n        vscode.window.registerWebviewViewProvider('atomic-tree-dashboard', provider)\r\n    );\r\n\r\n    // 2. Register Commands\r\n    context.subscriptions.push(vscode.commands.registerCommand('atomic-tree.startWorkload', () => {\r\n        startBackend(context, provider);\r\n        sendCommand({ method: 'runWorkload', params: { type: 'insert', count: 100 } });\r\n        vscode.window.showInformationMessage('Atomic Tree Workload Started');\r\n    }));\r\n\r\n    context.subscriptions.push(vscode.commands.registerCommand('atomic-tree.stopWorkload', () => {\r\n        sendCommand({ method: 'stopWorkload' });\r\n    }));\r\n\r\n    context.subscriptions.push(vscode.commands.registerCommand('atomic-tree.simulateCrash', () => {\r\n        sendCommand({ method: 'simulateCrash' });\r\n        vscode.window.showWarningMessage('Backend Crash Simulated!');\r\n    }));\r\n}\r\n\r\nfunction startBackend(context: vscode.ExtensionContext, provider: AtomicTreeWebviewProvider) {\r\n    if (backendProcess) return;\r\n\r\n    const workspaceFolders = vscode.workspace.workspaceFolders;\r\n\r\n    // 1. Check for custom backend path in settings\r\n    const config = vscode.workspace.getConfiguration('atomicTree');\r\n    let backendPath = config.get<string>('backendPath');\r\n\r\n    if (backendPath && backendPath.trim() !== '') {\r\n        // Support ${workspaceFolder} variable\r\n        if (workspaceFolders && workspaceFolders.length > 0) {\r\n            backendPath = backendPath.replace('${workspaceFolder}', workspaceFolders[0].uri.fsPath);\r\n        }\r\n        console.log(`Using custom backend: ${backendPath}`);\r\n    } else {\r\n        // 2. Default to bundled binary\r\n        backendPath = vscode.Uri.joinPath(context.extensionUri, 'bin', 'atomic-engine.exe').fsPath;\r\n        console.log(`Using bundled backend: ${backendPath}`);\r\n    }\r\n\r\n    if (!workspaceFolders) {\r\n        vscode.window.showErrorMessage(\"Open a folder to start Atomic Engine\");\r\n        return;\r\n    }\r\n\r\n    // IMPORTANT: In a real extension, we'd bundle the binary or download it.\r\n\r\n    try {\r\n        // Run in workspace root so pmem.dat is created there\r\n        const cwd = workspaceFolders[0].uri.fsPath;\r\n        backendProcess = spawn(backendPath, [], { cwd });\r\n\r\n        backendProcess.stdout?.on('data', (data) => {\r\n            const str = data.toString();\r\n            console.log(`Backend Out: ${str}`);\r\n\r\n            // Parse JSON lines and forward to Webview\r\n            const lines = str.split('\\n');\r\n            for (const line of lines) {\r\n                if (!line.trim()) continue;\r\n                try {\r\n                    const json = JSON.parse(line);\r\n                    provider.postMessage(json);\r\n                } catch (e) {\r\n                    // Ignore non-JSON output (debug logs)\r\n                }\r\n            }\r\n        });\r\n\r\n        backendProcess.stderr?.on('data', (data) => {\r\n            console.error(`Backend Err: ${data}`);\r\n        });\r\n\r\n        backendProcess.on('close', (code) => {\r\n            console.log(`Backend exited with code ${code}`);\r\n            backendProcess = undefined;\r\n            vscode.window.showErrorMessage(`Atomic Engine died (Exit Code: ${code})`);\r\n        });\r\n\r\n    } catch (e) {\r\n        vscode.window.showErrorMessage('Failed to start Atomic Engine backend');\r\n    }\r\n}\r\n\r\nfunction sendCommand(cmd: any) {\r\n    if (backendProcess && backendProcess.stdin) {\r\n        backendProcess.stdin.write(JSON.stringify(cmd) + '\\n');\r\n    }\r\n}\r\n\r\nexport function deactivate() {\r\n    if (backendProcess) {\r\n        backendProcess.kill();\r\n    }\r\n}\r\n\r\nclass AtomicTreeWebviewProvider implements vscode.WebviewViewProvider {\r\n    private _view?: vscode.WebviewView;\r\n\r\n    constructor(private readonly _extensionUri: vscode.Uri) { }\r\n\r\n    resolveWebviewView(webviewView: vscode.WebviewView) {\r\n        this._view = webviewView;\r\n        webviewView.webview.options = {\r\n            enableScripts: true,\r\n            localResourceRoots: [this._extensionUri]\r\n        };\r\n\r\n        webviewView.webview.html = this._getHtmlForWebview(webviewView.webview);\r\n    }\r\n\r\n    public postMessage(message: any) {\r\n        if (this._view) {\r\n            this._view.webview.postMessage(message);\r\n        }\r\n    }\r\n\r\n    private _getHtmlForWebview(webview: vscode.Webview) {\r\n        return `<!DOCTYPE html>\r\n        <html lang=\"en\">\r\n        <head>\r\n            <meta charset=\"UTF-8\">\r\n            <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n            <title>Atomic Tree Dashboard</title>\r\n            <style>\r\n                body { font-family: sans-serif; padding: 10px; }\r\n                .card { background: var(--vscode-editor-background); border: 1px solid var(--vscode-widget-border); padding: 10px; margin-bottom: 10px; }\r\n            </style>\r\n        </head>\r\n        <body>\r\n            <div class=\"card\">\r\n                <h3>Throughput</h3>\r\n                <div id=\"chart-throughput\" style=\"height: 100px;\">Waiting for data...</div>\r\n            </div>\r\n            <script>\r\n                // Listen for messages from extension\r\n                window.addEventListener('message', event => {\r\n                    const message = event.data;\r\n                    document.getElementById('chart-throughput').innerText = JSON.stringify(message, null, 2);\r\n                });\r\n            </script>\r\n        </body>\r\n        </html>`;\r\n    }\r\n}\r\n"],"names":["module","exports","require","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","__webpack_modules__","context","console","log","provider","AtomicTreeWebviewProvider","extensionUri","subscriptions","push","vscode","window","registerWebviewViewProvider","commands","registerCommand","backendProcess","workspaceFolders","workspace","backendPath","getConfiguration","get","trim","length","replace","uri","fsPath","Uri","joinPath","cwd","spawn","stdout","on","data","str","toString","lines","split","line","json","JSON","parse","postMessage","e","stderr","error","code","showErrorMessage","startBackend","sendCommand","method","params","type","count","showInformationMessage","showWarningMessage","kill","cmd","stdin","write","stringify","constructor","_extensionUri","resolveWebviewView","webviewView","this","_view","webview","options","enableScripts","localResourceRoots","html","_getHtmlForWebview","message"],"ignoreList":[],"sourceRoot":""}